<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>A terminal real time application with Dart Sockets | Max Weber - Developer, Publisher and Father</title>
<meta name=keywords content="dart,sockets,tutorial"><meta name=description content="In this article I want to tell you about my personal development story"><meta name=author content="Max Weber"><link rel=canonical href=https://flutter-explained.dev/posts/a-terminal-real-time-application-with-dart-sockets/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://flutter-explained.dev/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://flutter-explained.dev/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://flutter-explained.dev/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://flutter-explained.dev/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://flutter-explained.dev/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://flutter-explained.dev/posts/a-terminal-real-time-application-with-dart-sockets/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="A terminal real time application with Dart Sockets"><meta property="og:description" content="In this article I want to tell you about my personal development story"><meta property="og:type" content="article"><meta property="og:url" content="https://flutter-explained.dev/posts/a-terminal-real-time-application-with-dart-sockets/"><meta property="og:image" content="https://flutter-explained.dev/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-03T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-03T00:00:00+00:00"><meta property="og:site_name" content="Max Weber"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://flutter-explained.dev/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="A terminal real time application with Dart Sockets"><meta name=twitter:description content="In this article I want to tell you about my personal development story"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://flutter-explained.dev/posts/"},{"@type":"ListItem","position":2,"name":"A terminal real time application with Dart Sockets","item":"https://flutter-explained.dev/posts/a-terminal-real-time-application-with-dart-sockets/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"A terminal real time application with Dart Sockets","name":"A terminal real time application with Dart Sockets","description":"In this article I want to tell you about my personal development story","keywords":["dart","sockets","tutorial"],"articleBody":"We already covered in another Article what an HTTP call is and how it works in a Client - Server Architecture. But today, we want to look at how to keep a connection open between the Client and the server to implement a Real-Time Application.\nWhy do we need Sockets But what would Sockets benefit be compared to the standard HTTP Request Response method? In modern applications, we want real-time data, and who thinks now at Firebase Store etc. is correct because that is how they do it.\nBefore we had the benefit of WebSockets or Sockets, we had to wait until the server finished a task and make another request to get the data. Because the server never told us we were ready with the new data. Therefore, developers all around the world discovered some quite exciting workarounds like Pooling. At Polling, a client made a request every period (200+ ms) to check if there were new data present. Thanks to WebSockets and Sockets, we have the chance to reduce a load of our servers because we can reduce the calls needed. Furthermore, the server can directly notify the Client of the new information. Real-Time applications are born.\nSockets vs. WebSockets At the beginning of my journey, I tried to use Shelf_WebSockets and connect with my two Terminals, and the result was nothing. Interestingly, I could connect via the terminal clients to the server, but whenever I sent a message, it was just not visible, and the server did not show anything.\nAfter a long time of learning and debugging, I discovered that my Terminal used dart:io and needed a server to work with the same TCP Sockets. Unfortunately, while the WebSocket Server allowed the connections, it could not understand the messages the Terminals tried to send.\nWhy is that the case? WebSockets are upgraded HTTP request that allows the open connection between a client and a server. However, WebSockets are usually used to connect from a Browser or a UI to the server, making it problematic. Some packages allow Terminals to connect against a WebSocket server, but I did not use them. Therefore I needed to change my WebSocket Server to a TCP Socket Server.\nSo the rest of the tutorial will only use a Socket Server and Socket Clients. Still, you can achieve the same with WebSocket Server and a WebSocket Client, for example, websocket_manager that allows Flutter to connect against a WebSocket Server.\nIf you want to know more about Sockets vs WebSockets, I recommend reading the MDN post about WebSockets and the StackOverflow answer. Great, now that we have that out of the way, let’s see how we can develop our application.\nImplementation We will now see the best part of the implementation is that we do not rely on any package. To make this possible default dart is enough to make it work, which is incredible. The only package I added is optional and is called ansicolor and allows to make prints in the console a bit more colourful.\nI created a basic barebone Dart project without anything inside but a terminal executable. After all, we do not need the boilerplate from the Server app because we want to use Sockets :).\nNow I deleted everything in the bin folder and created three files client.dart, server.dart and terminal_service.dart. In the Client.dart, we will collect all information about the Client, how he connects to the server and the message he sends. In the end, we can start multiple clients against a single server. The second file is the server.dart inside here, we write everything to receive messages from multiple clients and notify all clients that there something new happens.\nLast but not least, we have the terminal_service.dart is just a mini service containing different print functions for different colours. The result after the tutorial will look something like this.\nSetup the Server First, we start as always within the main function. Inside here, we want to find the local IP address and allow us to find just an unused IP address. Then we create a ServerSocket and bind the IP and a port. In our case, the port is fixated on 3000. after that, we just let the server listen to incoming connections, so whenever someone connects to the server, the callback is in the server.listen(callback) will be executed.\nFuture\u003cvoid\u003e main() async { final ip = InternetAddress.anyIPv4; final server = await ServerSocket.bind(ip, 3000); print(\"Server is running on: ${ip.address}:3000\"); server.listen((Socket client) { handleConnection(client); }); } Whenever a client is connecting to our server, we call handleConnection. Inside, we want to inform the server of an incoming connection. The socket we receive in the handleConnection is the information on communicating to that specific Client. If you want, for example, to create multiple players, you can save that socket to have a reference between player and socket to send messages between specific players. Now we must listen to the Client if the Client sends the server some messages.\nList\u003cSocket\u003e clients = []; void handleConnection(Socket client) { printGreen( \"Server: Connection from ${client.remoteAddress.address}:${client.remotePort}\", ); client.listen( ... ); } Before, we already had the server.listenwhere the server waited for connections. Now we haveclient.listen, so we on the server wait for the client to send us some notifications. The client.listenfunction has some information we have to pass in. The first part is how to handle messages from the Client. So we will receive a Uint8List message that is just a basic ByteString, and because we will be in complete control of the Client, we know that this will be a plain string so that we can transcode it withString.fromCharCodes(data).\nIn that message, we want our users to send the player name so we can inform every Client that is already connected to the server.\nclient.listen( (Uint8List data) async { final message = String.fromCharCodes(data); for(final c in clients) { c.write(\\\"Server: $message joined the party!\\\"); } clients.add(client); client.write(\\\"Server: You are logged in as: $message\\\"); }, onError: ... onDone: ... ... ) Implement the Client First, we create another file called client.dart in our Dart Project. Here we will implement the client application that will connect to our server. The Client works similar to the server and should be a standalone Dart application. Therefore, we need another main function. In this main function, we connect with a Socket to our server with the IP we get from the server command:\nFuture\u003cvoid\u003e main(){ final socket = await Socket.connect(\"0.0.0.0\", 3000); print('Connected to ${socket.remoteAddress.address}:${socket.remotePort}'); } When we execute the client.dart file without anything further, we will already get the information on our Terminal where the server is running. It should look something like this.\n➜ dart ./bin/client.dart Connected to: 127.0.0.1:3000 ➜ dart ./bin/server.dart Server is running on: 0.0.0.0:3000 Server: Connection from 127.0.0.1:53419 Therefore we can see that the server already receives the connection and keeps the connection open for the IP 127.0.0.1:53419. The IP points are also the same computer, but the IP and the Port could be entirely different for your implementation. Great, so the connection is already stable so let’s send some messages from the Client to the server and see how we can handle them. We will ask the user for his name and send the information to the server.\n// Ask user for its username String? username; do { print(\"Client: Please enter your username\"); username = stdin.readLineSync(); } while (username == null || username.isEmpty); socket.write(username); We first define a variable username that could be null, and in the do-while-loop, we ask the user for a terminal input to enter the username. If the username is null or empty, we ask him again until we get the needed information. After that, we call socket.write(username), which sends the information directly to the server. But if we restart the server and the Client now, we will see nothing has changed. The message is now only sent to the server; if we recheck the server, we see that we send the message to the Client.\nclient.write(\"Server: You are logged in as: $message\");\nOn the other hand, the Client does not listen to server messages and cannot show what the server sends. So let us make the Client smarter and allow it to receive messages sent by the server.\nsocket.listen( (Uint8List data) { final serverResponse = String.fromCharCodes(data); printGreen(\\\"Client $serverResponse\\\"); }, onError: (error) { print(\"Client: $error\"); socket.destroy(); }, onDone: () { print('Client: Server left.'); socket.destroy(); }, ); ` If we check the socket, we can see that it also provides the `listen` method and also here, we have the chance to implement the same three methods as on the Server side. Therefore we implemented them nearly the same. The only difference is that the onData method now receives the message and directly prints them into the console. If we start up now the Server and Client, we should be able to see something like this: ```ssh ➜ dart ./bin/server.dart Server is running on: 0.0.0.0:3000 Server: Connection from 127.0.0.1:54384 ➜ dart ./bin/client.dart Server: Connected to: 127.0.0.1:3000 Client: Please enter your username Max Client Server: You are logged in as: Max And if we create another client the following will happen:\n➜ dart ./bin/client.dart Server: Connected to: 127.0.0.1:3000 Client: Please enter your username Mahtab Client Server: You are logged in as: Mahtab ➜ dart ./bin/client.dart Server: Connected to: 127.0.0.1:3000 Client: Please enter your username Max Client Server: You are logged in as: Max Client Server: Mahtab joined the party! ➜ dart ./bin/server.dart Server is running on: 0.0.0.0:3000 Server: Connection from 127.0.0.1:54384 Server: Connection from 127.0.0.1:54415 Conclusion We now have a successful Socket Server running and multiple clients connected. After this tutorial, you should have the power to create excellent applications that need real-time experience. That can be integrated with Games but also in Tools where collaboration is vital. You can find the tutorial project on Codeberg. Feel free to check it out, and if there are any thoughts, please let us know. Thanks for reading, and till the next post.\nThank you for reading, stay curious and if you have time consider supporting me on Patreon.\n","wordCount":"1674","inLanguage":"en","image":"https://flutter-explained.dev/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2022-08-03T00:00:00Z","dateModified":"2022-08-03T00:00:00Z","author":{"@type":"Person","name":"Max Weber"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://flutter-explained.dev/posts/a-terminal-real-time-application-with-dart-sockets/"},"publisher":{"@type":"Organization","name":"Max Weber - Developer, Publisher and Father","logo":{"@type":"ImageObject","url":"https://flutter-explained.dev/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://flutter-explained.dev/ accesskey=h title="Home (Alt + H)"><img src=https://flutter-explained.dev/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://flutter-explained.dev/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://flutter-explained.dev/>Home</a>&nbsp;»&nbsp;<a href=https://flutter-explained.dev/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">A terminal real time application with Dart Sockets</h1><div class=post-description>In this article I want to tell you about my personal development story</div><div class=post-meta><span title='2022-08-03 00:00:00 +0000 UTC'>August 3, 2022</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1674 words&nbsp;·&nbsp;Max Weber&nbsp;|&nbsp;<a href=https://github.com/md-weber/website/tree/main/content/posts/a-terminal-real-time-application-with-dart-sockets.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#why-do-we-need-sockets>Why do we need Sockets</a></li><li><a href=#sockets-vs-websockets>Sockets vs. WebSockets</a></li><li><a href=#implementation>Implementation</a><ul><li><a href=#setup-the-server>Setup the Server</a></li></ul></li><li><a href=#implement-the-client>Implement the Client</a><ul><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>We already covered in another <a href=https://flutter-explained.dev/deploy-dart-server-on-heroku>Article</a> what an HTTP call is and how it works in a Client - Server Architecture. But today, we want to look at how to keep a connection open between the Client and the server to implement a Real-Time Application.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube-nocookie.com/embed/cpEYw8HuoxI?autoplay=0&controls=1&end=0&loop=0&mute=0&start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><h2 id=why-do-we-need-sockets>Why do we need Sockets<a hidden class=anchor aria-hidden=true href=#why-do-we-need-sockets>#</a></h2><p>But what would Sockets benefit be compared to the standard HTTP Request Response method? In modern applications, we want real-time data, and who thinks now at Firebase Store etc. is correct because that is how they do it.</p><p>Before we had the benefit of WebSockets or Sockets, we had to wait until the server finished a task and make another request to get the data. Because the server never told us we were ready with the new data. Therefore, developers all around the world discovered some quite exciting workarounds like Pooling. At Polling, a client made a request every period (200+ ms) to check if there were new data present. Thanks to WebSockets and Sockets, we have the chance to reduce a load of our servers because we can reduce the calls needed. Furthermore, the server can directly notify the Client of the new information. Real-Time applications are born.</p><h2 id=sockets-vs-websockets>Sockets vs. WebSockets<a hidden class=anchor aria-hidden=true href=#sockets-vs-websockets>#</a></h2><p>At the beginning of my journey, I tried to use <a href=https://pub.dev/packages/shelf_web_socket>Shelf_WebSockets</a> and connect with my two Terminals, and the result was nothing. Interestingly, I could connect via the terminal clients to the server, but whenever I sent a message, it was just not visible, and the server did not show anything.</p><p><img loading=lazy src=//images.ctfassets.net/573xlmlwok2s/4cCI6viOhHv1o4nz8u6KQV/f60b5cc79a91870e9aae17b9dde6f4cb/Screenshot_2022-07-04_at_16.15.26.png alt="Example with Websockets"></p><p>After a long time of learning and debugging, I discovered that my Terminal used <a href=https://api.dart.dev/stable/2.17.3/dart-io/Socket-class.html>dart:io</a> and needed a server to work with the same TCP Sockets. Unfortunately, while the WebSocket Server allowed the connections, it could not understand the messages the Terminals tried to send.</p><p>Why is that the case? WebSockets are upgraded HTTP request that allows the open connection between a client and a server. However, WebSockets are usually used to connect from a Browser or a UI to the server, making it problematic. Some packages allow Terminals to connect against a WebSocket server, but I did not use them. Therefore I needed to change my WebSocket Server to a TCP Socket Server.</p><p>So the rest of the tutorial will only use a Socket Server and Socket Clients. Still, you can achieve the same with WebSocket Server and a WebSocket Client, for example, <a href=https://pub.dev/packages/websocket_manager>websocket_manager</a> that allows Flutter to connect against a WebSocket Server.</p><p>If you want to know more about Sockets vs WebSockets, I recommend reading the MDN post about <a href=https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API>WebSockets</a> and the <a href=https://stackoverflow.com/questions/4973622/difference-between-socket-and-websocket>StackOverflow</a> answer. Great, now that we have that out of the way, let&rsquo;s see how we can develop our application.</p><h2 id=implementation>Implementation<a hidden class=anchor aria-hidden=true href=#implementation>#</a></h2><p>We will now see the best part of the implementation is that we do not rely on any package. To make this possible default dart is enough to make it work, which is incredible. The only package I added is optional and is called <a href=https://pub.dev/packages/ansicolor>ansicolor</a> and allows to make prints in the console a bit more colourful.</p><p>I created a basic barebone Dart project without anything inside but a terminal executable. After all, we do not need the boilerplate from the Server app because we want to use Sockets :).</p><p>Now I deleted everything in the bin folder and created three files <code>client.dart</code>, <code>server.dart</code> and <code>terminal_service.dart</code>. In the Client.dart, we will collect all information about the Client, how he connects to the server and the message he sends. In the end, we can start multiple clients against a single server. The second file is the server.dart inside here, we write everything to receive messages from multiple clients and notify all clients that there something new happens.</p><p>Last but not least, we have the terminal_service.dart is just a mini service containing different print functions for different colours. The result after the tutorial will look something like this.</p><p><img loading=lazy src=//images.ctfassets.net/573xlmlwok2s/E4jewvjn1J370kWe37HUZ/5bf8526d48f85911f779e296e2c8487a/Screenshot_2022-07-04_at_22.27.40.png alt="Socket Server allows two connections - Solution"></p><h3 id=setup-the-server>Setup the Server<a hidden class=anchor aria-hidden=true href=#setup-the-server>#</a></h3><p>First, we start as always within the main function. Inside here, we want to find the local IP address and allow us to find just an unused IP address. Then we create a ServerSocket and bind the IP and a port. In our case, the port is fixated on 3000. after that, we just let the server listen to incoming connections, so whenever someone connects to the server, the callback is in the <code>server.listen(callback)</code> will be executed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=n>Future</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=n>main</span><span class=p>()</span> <span class=kd>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>final</span> <span class=n>ip</span> <span class=o>=</span> <span class=n>InternetAddress</span><span class=p>.</span><span class=n>anyIPv4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>final</span> <span class=n>server</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>ServerSocket</span><span class=p>.</span><span class=n>bind</span><span class=p>(</span><span class=n>ip</span><span class=p>,</span> <span class=m>3000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=s2>&#34;Server is running on: </span><span class=si>${</span><span class=n>ip</span><span class=p>.</span><span class=n>address</span><span class=si>}</span><span class=s2>:3000&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>server</span><span class=p>.</span><span class=n>listen</span><span class=p>((</span><span class=n>Socket</span> <span class=n>client</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>handleConnection</span><span class=p>(</span><span class=n>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Whenever a client is connecting to our server, we call handleConnection. Inside, we want to inform the server of an incoming connection. The socket we receive in the handleConnection is the information on communicating to that specific Client. If you want, for example, to create multiple players, you can save that socket to have a reference between player and socket to send messages between specific players. Now we must listen to the Client if the Client sends the server some messages.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=n>List</span><span class=o>&lt;</span><span class=n>Socket</span><span class=o>&gt;</span> <span class=n>clients</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=n>handleConnection</span><span class=p>(</span><span class=n>Socket</span> <span class=n>client</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>printGreen</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Server: Connection from </span><span class=si>${</span><span class=n>client</span><span class=p>.</span><span class=n>remoteAddress</span><span class=p>.</span><span class=n>address</span><span class=si>}</span><span class=s2>:</span><span class=si>${</span><span class=n>client</span><span class=p>.</span><span class=n>remotePort</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>client</span><span class=p>.</span><span class=n>listen</span><span class=p>(</span> <span class=p>...</span> <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Before, we already had the <code>server.listen</code>where the server waited for connections. Now we have<code>client.listen</code>, so we on the server wait for the client to send us some notifications. The <code>client.listen</code>function has some information we have to pass in. The first part is how to handle messages from the Client. So we will receive a Uint8List message that is just a basic ByteString, and because we will be in complete control of the Client, we know that this will be a plain string so that we can transcode it with<code>String.fromCharCodes(data)</code>.</p><p>In that message, we want our users to send the player name so we can inform every Client that is already connected to the server.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=n>client</span><span class=p>.</span><span class=n>listen</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>Uint8List</span> <span class=n>data</span><span class=p>)</span> <span class=kd>async</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>message</span> <span class=o>=</span> <span class=kt>String</span><span class=p>.</span><span class=n>fromCharCodes</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kd>final</span> <span class=n>c</span> <span class=k>in</span> <span class=n>clients</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>c</span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=err>\</span><span class=s2>&#34;Server: </span><span class=si>$</span><span class=n>message</span><span class=s2> joined the party!</span><span class=se>\&#34;</span><span class=s2>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>clients</span><span class=p>.</span><span class=n>add</span><span class=p>(</span><span class=n>client</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>client</span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=err>\</span><span class=s2>&#34;Server: You are logged in as: </span><span class=si>$</span><span class=n>message</span><span class=se>\&#34;</span><span class=s2>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span>
</span></span><span class=line><span class=cl><span class=nl>onError:</span> <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=nl>onDone:</span> <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><h2 id=implement-the-client>Implement the Client<a hidden class=anchor aria-hidden=true href=#implement-the-client>#</a></h2><p>First, we create another file called <code>client.dart</code> in our Dart Project. Here we will implement the client application that will connect to our server. The Client works similar to the server and should be a standalone Dart application. Therefore, we need another main function. In this main function, we connect with a Socket to our server with the IP we get from the server command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=n>Future</span><span class=o>&lt;</span><span class=kt>void</span><span class=o>&gt;</span> <span class=n>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>  <span class=kd>final</span> <span class=n>socket</span> <span class=o>=</span> <span class=kd>await</span> <span class=n>Socket</span><span class=p>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;0.0.0.0&#34;</span><span class=p>,</span> <span class=m>3000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Connected to </span><span class=si>${</span><span class=n>socket</span><span class=p>.</span><span class=n>remoteAddress</span><span class=p>.</span><span class=n>address</span><span class=si>}</span><span class=s1>:</span><span class=si>${</span><span class=n>socket</span><span class=p>.</span><span class=n>remotePort</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>When we execute the client.dart file without anything further, we will already get the information on our Terminal where the server is running. It should look something like this.</p><pre tabindex=0><code class=language-ssh data-lang=ssh>➜ dart ./bin/client.dart
Connected to: 127.0.0.1:3000
</code></pre><pre tabindex=0><code class=language-ssh data-lang=ssh>➜ dart ./bin/server.dart
Server is running on: 0.0.0.0:3000
Server: Connection from 127.0.0.1:53419
</code></pre><p>Therefore we can see that the server already receives the connection and keeps the connection open for the IP 127.0.0.1:53419. The IP points are also the same computer, but the IP and the Port could be entirely different for your implementation. Great, so the connection is already stable so let&rsquo;s send some messages from the Client to the server and see how we can handle them. We will ask the user for his name and send the information to the server.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=c1>// Ask user for its username
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>String</span><span class=o>?</span> <span class=n>username</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>print</span><span class=p>(</span><span class=s2>&#34;Client: Please enter your username&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>username</span> <span class=o>=</span> <span class=n>stdin</span><span class=p>.</span><span class=n>readLineSync</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=n>username</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>username</span><span class=p>.</span><span class=n>isEmpty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>socket</span><span class=p>.</span><span class=n>write</span><span class=p>(</span><span class=n>username</span><span class=p>);</span>
</span></span></code></pre></div><p>We first define a variable username that could be null, and in the do-while-loop, we ask the user for a terminal input to enter the username. If the username is null or empty, we ask him again until we get the needed information. After that, we call socket.write(username), which sends the information directly to the server. But if we restart the server and the Client now, we will see nothing has changed. The message is now only sent to the server; if we recheck the server, we see that we send the message to the Client.</p><p><code>client.write("Server: You are logged in as: $message");</code></p><p>On the other hand, the Client does not listen to server messages and cannot show what the server sends. So let us make the Client smarter and allow it to receive messages sent by the server.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dart data-lang=dart><span class=line><span class=cl><span class=n>socket</span><span class=p>.</span><span class=n>listen</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=n>Uint8List</span> <span class=n>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>serverResponse</span> <span class=o>=</span> <span class=kt>String</span><span class=p>.</span><span class=n>fromCharCodes</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>printGreen</span><span class=p>(</span><span class=err>\</span><span class=s2>&#34;Client </span><span class=si>$</span><span class=n>serverResponse</span><span class=se>\&#34;</span><span class=s2>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nl>onError:</span> <span class=p>(</span><span class=n>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=s2>&#34;Client: </span><span class=si>$</span><span class=n>error</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>socket</span><span class=p>.</span><span class=n>destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nl>onDone:</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>print</span><span class=p>(</span><span class=s1>&#39;Client: Server left.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>socket</span><span class=p>.</span><span class=n>destroy</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=err>`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>If</span> <span class=n>we</span> <span class=n>check</span> <span class=n>the</span> <span class=n>socket</span><span class=p>,</span> <span class=n>we</span> <span class=n>can</span> <span class=n>see</span> <span class=n>that</span> <span class=n>it</span> <span class=n>also</span> <span class=n>provides</span> <span class=n>the</span> <span class=err>`</span><span class=n>listen</span><span class=err>`</span> <span class=n>method</span> <span class=n>and</span> <span class=n>also</span> <span class=n>here</span><span class=p>,</span> <span class=n>we</span> <span class=n>have</span> <span class=n>the</span> <span class=n>chance</span> <span class=n>to</span> <span class=n>implement</span> <span class=n>the</span> <span class=n>same</span> <span class=n>three</span> <span class=n>methods</span> <span class=o>as</span> <span class=n>on</span> <span class=n>the</span> <span class=n>Server</span> <span class=n>side</span><span class=p>.</span> <span class=n>Therefore</span> <span class=n>we</span> <span class=n>implemented</span> <span class=n>them</span> <span class=n>nearly</span> <span class=n>the</span> <span class=n>same</span><span class=p>.</span> <span class=n>The</span> <span class=n>only</span> <span class=n>difference</span> <span class=k>is</span> <span class=n>that</span> <span class=n>the</span> <span class=n>onData</span> <span class=n>method</span> <span class=n>now</span> <span class=n>receives</span> <span class=n>the</span> <span class=n>message</span> <span class=n>and</span> <span class=n>directly</span> <span class=n>prints</span> <span class=n>them</span> <span class=n>into</span> <span class=n>the</span> <span class=n>console</span><span class=p>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>If</span> <span class=n>we</span> <span class=n>start</span> <span class=n>up</span> <span class=n>now</span> <span class=n>the</span> <span class=n>Server</span> <span class=n>and</span> <span class=n>Client</span><span class=p>,</span> <span class=n>we</span> <span class=n>should</span> <span class=n>be</span> <span class=n>able</span> <span class=n>to</span> <span class=n>see</span> <span class=n>something</span> <span class=n>like</span> <span class=k>this</span><span class=o>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>```</span><span class=n>ssh</span>
</span></span><span class=line><span class=cl><span class=err>➜</span> <span class=n>dart</span> <span class=p>.</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>server</span><span class=p>.</span><span class=n>dart</span>
</span></span><span class=line><span class=cl><span class=n>Server</span> <span class=k>is</span> <span class=n>running</span> <span class=nl>on:</span> <span class=m>0.0</span><span class=p>.</span><span class=m>0.0</span><span class=o>:</span><span class=m>3000</span>
</span></span><span class=line><span class=cl><span class=nl>Server:</span> <span class=n>Connection</span> <span class=n>from</span> <span class=m>127.0</span><span class=p>.</span><span class=m>0.1</span><span class=o>:</span><span class=m>54384</span>
</span></span></code></pre></div><pre tabindex=0><code class=language-ssh data-lang=ssh>➜ dart ./bin/client.dart
Server: Connected to: 127.0.0.1:3000
Client: Please enter your username

Max
Client Server: You are logged in as: Max
</code></pre><p>And if we create another client the following will happen:</p><pre tabindex=0><code class=language-ssh data-lang=ssh>➜ dart ./bin/client.dart
Server: Connected to: 127.0.0.1:3000
Client: Please enter your username
Mahtab
Client Server: You are logged in as: Mahtab
</code></pre><pre tabindex=0><code class=language-ssh data-lang=ssh>➜ dart ./bin/client.dart
Server: Connected to: 127.0.0.1:3000
Client: Please enter your username
Max
Client Server: You are logged in as: Max
Client Server: Mahtab joined the party!
</code></pre><pre tabindex=0><code class=language-ssh data-lang=ssh>➜ dart ./bin/server.dart
Server is running on: 0.0.0.0:3000
Server: Connection from 127.0.0.1:54384
Server: Connection from 127.0.0.1:54415
</code></pre><h3 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h3><p>We now have a successful Socket Server running and multiple clients connected. After this tutorial, you should have the power to create excellent applications that need real-time experience. That can be integrated with Games but also in Tools where collaboration is vital.
You can find the tutorial project on Codeberg. Feel free to check it out, and if there are any thoughts, please let us know. Thanks for reading, and till the next post.</p><p>Thank you for reading, stay curious and if you have time consider supporting me on <a href=https://patreon.com/dev_cafe>Patreon</a>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://flutter-explained.dev/tags/dart/>Dart</a></li><li><a href=https://flutter-explained.dev/tags/sockets/>Sockets</a></li><li><a href=https://flutter-explained.dev/tags/tutorial/>Tutorial</a></li></ul><nav class=paginav><a class=prev href=https://flutter-explained.dev/posts/personal_dev_story/><span class=title>« Prev</span><br><span>My personal career path</span>
</a><a class=next href=https://flutter-explained.dev/posts/deploy-dart-server-on-heroku/><span class=title>Next »</span><br><span>Deployment of a Dart Server on Heroku</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://flutter-explained.dev/>Max Weber - Developer, Publisher and Father</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><style>.custom-footer{display:flex;margin:0 auto;font-size:11px;justify-content:center}.custom-footer a{padding:10px}</style><nav class=custom-footer><a href=/data-privacy>Data Privacy</a>
<a href=/imprint>Imprint</a>
<a href=#manage-consent>Manage Consent</a></nav><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><style>#consent-notice{padding:1rem;display:none;text-align:center;position:fixed;bottom:0;width:calc(100% - 2rem);background:#222;color:rgba(255,255,255,.8)}#consent-notice span{margin-right:1rem}#consent-notice button{cursor:pointer;display:inline-block;width:auto}#consent-notice span a{color:inherit;text-decoration:underline;text-decoration-color:rgba(255,255,255,.5)}#consent-notice button.btn{margin-left:.5rem}#consent-notice button.btn.manage-consent{background:rgba(255,255,255,.1);font-weight:400}#consent-overlay{position:fixed;left:0;top:0;width:100%;height:100vh;display:none;background:rgba(0,0,0,.75);z-index:999999;overflow:auto;cursor:pointer}#consent-overlay.active{display:flex}#consent-overlay>div{background:#fff;width:100%;max-width:30rem;padding:1.75rem;margin:auto;cursor:initial}#consent-overlay>div>div{display:flex;align-items:flex-start;margin-bottom:1rem}#consent-overlay>div>div:last-child{margin:0}#consent-overlay h3{padding-top:0}#consent-overlay input{margin-top:.3rem}#consent-overlay label{display:block}#consent-overlay .btn{margin-right:.5rem}#consent-overlay button.btn.save-consent{background:rgba(0,0,0,.6);font-weight:400}@media(max-width:767px){#consent-overlay>div{padding:1.75rem 1rem}#consent-notice span{display:block;padding-top:3px;margin-bottom:1.5rem}#consent-notice button.btn{position:relative;bottom:4px}}</style><div id=consent-notice><span>We would like to use
<a class=manage-consent href=#manage-consent>third party code</a> to
improve the functionality of this website.</span><button class="btn manage-consent">Manage preferences</button><button class="btn deny-consent">Deny</button><button class="btn approve-consent">Allow</button></div><div id=consent-overlay><div><div><input type=checkbox id=item0 value=1 name=item0>
<label for=item0><h3>YouTube</h3><p>This code will be used to integrate YouTube videos right into my website so you can see them on relevant blog posts.</p></label></div><div><input type=checkbox id=item1 value=1 name=item1>
<label for=item1><h3>YouTube Embed Player</h3><p>This code will be used to integrate YouTube videos right into my website so you can see them on relevant blog posts.</p></label></div><div><button id=save-consent class="btn save-consent" data-consentvalue=00>
Save preferences
</button>
<button class="btn approve-consent">Allow all</button></div></div></div><script>const scripts=[];scripts[0]="/js/embed.js",scripts[1]="/js/www-embed-player.js";function createCookie(e,t,n){var s,o="";n&&(s=new Date,s.setTime(s.getTime()+n*24*60*60*1e3),o="; expires="+s.toUTCString()),document.cookie=e+"="+t+o+"; path=/"}function readCookie(e){for(var t,s=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(t=o[n];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(s)==0)return t.substring(s.length,t.length)}return null}function eraseCookie(e){createCookie(e,"",-1)}function denyAllConsentScripts(){var e="";scripts.forEach(function(){e=e+"0"}),acceptSomeConsentScripts(e)}function acceptAllConsentScripts(){var e="";scripts.forEach(function(){e=e+"1"}),acceptSomeConsentScripts(e)}function acceptSomeConsentScripts(e){setConsentInputs(e),createCookie("consent-settings",e,31),document.getElementById("consent-notice").style.display="none",document.getElementById("consent-overlay").classList.remove("active"),loadConsentScripts(e)}function loadConsentScripts(e){scripts.forEach(function(t,n){if(e[n]=="1"){var s=document.createElement("script");s.type="text/javascript",s.src=t,document.body.appendChild(s)}})}function setConsentInputs(e){var t=document.querySelectorAll("#consent-overlay input:not([disabled])");t.forEach(function(t,n){e[n]=="1"?t.checked=!0:t.checked=!1})}function setConsentValue(){var t=document.querySelectorAll("#consent-overlay input:not([disabled])"),e="";t.forEach(function(t){t.checked?e=e+"1":e=e+"0"}),document.getElementById("save-consent").dataset.consentvalue=e}var consentValue,elements=document.querySelectorAll("#consent-overlay input:not([disabled])");elements.forEach(function(e){e.checked=!1}),readCookie("consent-settings")?(consentValue=readCookie("consent-settings").toString(),setConsentInputs(consentValue),loadConsentScripts(consentValue)):document.getElementById("consent-notice").style.display="block",elements=document.querySelectorAll(".manage-consent"),elements.forEach(function(e){e.addEventListener("click",function(){document.getElementById("consent-overlay").classList.toggle("active")})}),elements=document.querySelectorAll(".deny-consent"),elements.forEach(function(e){e.addEventListener("click",function(){denyAllConsentScripts()})}),elements=document.querySelectorAll(".approve-consent"),elements.forEach(function(e){e.addEventListener("click",function(){acceptAllConsentScripts()})}),document.getElementById("save-consent").addEventListener("click",function(){setConsentValue(),acceptSomeConsentScripts(this.dataset.consentvalue)}),document.getElementById("consent-overlay").addEventListener("click",function(e){document.querySelector("#consent-overlay > div").contains(e.target)||this.classList.toggle("active")})</script></body></html>